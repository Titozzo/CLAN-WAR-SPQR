<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SPQR Clan War</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #dfe6eb;
  padding: 15px;
}

#loginBox {
  text-align: center;
  margin-bottom: 10px;
}

button, select, input {
  padding: 5px;
  margin: 4px;
}

.admin-only, .member-only {
  display: none;
}

.war-container {
  background: white;
  border-radius: 10px;
  overflow: hidden;
}

.header {
  display: flex;
  justify-content: space-between;
  padding: 12px;
  background: #2c3e50;
  color: white;
  align-items: center;
}

.clan-header {
  width: 45%;
  display: flex;
  align-items: center;
  gap: 10px;
}

.clan-header.right {
  justify-content: flex-end;
  text-align: right;
}

.clan-header img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  background: white;
  border-radius: 6px;
}

.war-row {
  display: flex;
  align-items: center;
  border-top: 1px solid #ddd;
  padding: 8px;
}

.base {
  width: 40%;
}

.base.right {
  text-align: right;
}

.base img {
  width: 75px;
  height: 75px;
  object-fit: cover;
  border: 1px solid #ccc;
  margin-top: 5px;
}

.middle {
  width: 20%;
  text-align: center;
  font-weight: bold;
}

#warControls {
  text-align: center;
  margin-bottom: 10px;
}

.war-row input:disabled {
  background: #eee;
  cursor: not-allowed;
}
</style>
</head>
<body>

<div id="loginBox">
  <h1>SPQR WAR</h1>
  <div>
    <h3>Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="login('admin')">Login</button>
  </div>
  <div>
    <h3>Members Login</h3>
    <input type="password" id="memberPass" placeholder="Password">
    <button onclick="login('member')">Login</button>
  </div>
</div>

<div id="warControls" class="admin-only">
  War Size:
  <select id="warSize">
    <option>10</option>
    <option>15</option>
    <option>20</option>
    <option>25</option>
    <option>30</option>
    <option>35</option>
    <option>40</option>
    <option>45</option>
    <option>50</option>
  </select>
  <button onclick="startWar()">Start War</button>
  <button onclick="deleteWar()">Delete War</button>
</div>

<div class="war-container">

  <div class="header">
    <div class="clan-header">
      <img id="spqrLogo" style="display:none">
      <div>
        <strong>SPQR</strong><br>
        <span class="admin-only">
          Logo: <input type="file" accept="image/*" onchange="loadClanLogo(this,'spqrLogo','spqrLogoData')">
        </span>
      </div>
    </div>

    <div class="clan-header right">
      <div>
        <strong id="enemyName">Enemy Clan</strong><br>
        <span class="admin-only">
          Name:
          <input id="enemyNameInput" placeholder="Enemy name" oninput="updateEnemyName()"><br>
          Logo:
          <input type="file" accept="image/*" onchange="loadClanLogo(this,'enemyLogo','enemyLogoData')">
        </span>
      </div>
      <img id="enemyLogo" style="display:none">
    </div>
  </div>

  <div id="warMap"></div>
</div>

<script>
const ADMIN_PASSWORD = "ILikeFeet";
const MEMBER_PASSWORD = "ForzaLazio";
let isAdmin = false;
let isMember = false;
let warSize = 0;

document.addEventListener("DOMContentLoaded", () => {
  const spqrLogoData = localStorage.getItem('spqrLogoData');
  if(spqrLogoData){
    const img = document.getElementById('spqrLogo');
    img.src = spqrLogoData;
    img.style.display = 'block';
  }
});

function login(type){
  if(type === 'admin' && document.getElementById("adminPass").value === ADMIN_PASSWORD){
    isAdmin = true;
  } else if(type === 'member' && document.getElementById("memberPass").value === MEMBER_PASSWORD){
    isMember = true;
  } else{
    alert("Wrong password");
    return;
  }
  document.getElementById("loginBox").style.display = "none";
  toggleViews();
  loadWarFromStorage();
}

function toggleViews(){
  document.querySelectorAll(".admin-only").forEach(el => el.style.display = isAdmin ? "block" : "none");
  document.querySelectorAll(".member-only").forEach(el => el.style.display = isMember ? "block" : "none");
  if(isAdmin || isMember){
    document.getElementById("warMap").style.display = "block";
    document.getElementById("warControls").style.display = isAdmin ? "block" : "none";
  }
}

function startWar(){
  warSize = parseInt(document.getElementById("warSize").value);
  localStorage.setItem("warSize", warSize);
  generateWarMap();
  saveWarData();
}

function generateWarMap(){
  const map = document.getElementById("warMap");
  map.innerHTML = "";
  for(let i=1; i<=warSize; i++){
    map.appendChild(createRow(i));
  }
  if(isMember && !isAdmin){
    const rows = map.querySelectorAll(".war-row");
    rows.forEach(row => {
      row.querySelectorAll(".base input, .base.right input, .base input[type=file], .base.right input[type=file]").forEach(inp => {
        inp.disabled = true;
      });
    });
  }
}

function createRow(n){
  const row = document.createElement("div");
  row.className = "war-row";
  row.innerHTML = `
    <div class="base">
      <strong>SPQR #${n}</strong>
      <div class="admin-only">
        <input placeholder="Name" oninput="saveWarData()">
        <input type="file" accept="image/*" onchange="loadImage(this)">
      </div>
      <img style="display:none">
    </div>

    <div class="middle">
      attacks â†’<br>
      <select onchange="saveWarData()">${enemyOptions()}</select>
    </div>

    <div class="base right">
      <strong>Enemy #${n}</strong>
      <div class="admin-only">
        <input placeholder="Name" oninput="saveWarData()">
        <input type="file" accept="image/*" onchange="loadImage(this)">
      </div>
      <img style="display:none">
    </div>
  `;
  return row;
}

function enemyOptions(){
  let o = "<option>-- target --</option>";
  for(let i=1;i<=warSize;i++) o += `<option>Enemy #${i}</option>`;
  return o;
}

function loadImage(input){
  const img = input.parentElement.nextElementSibling;
  img.src = URL.createObjectURL(input.files[0]);
  img.style.display = "block";
  saveWarData();
}

function loadClanLogo(input, id, storageKey){
  const img = document.getElementById(id);
  img.src = URL.createObjectURL(input.files[0]);
  img.style.display = "block";
  if(storageKey === 'spqrLogoData') localStorage.setItem(storageKey, img.src);
  if(storageKey === 'enemyLogoData') saveWarData();
}

function updateEnemyName(){
  document.getElementById("enemyName").textContent = document.getElementById("enemyNameInput").value || "Enemy Clan";
  saveWarData();
}

function saveWarData(){
  const data = {
    warSize,
    enemyName: document.getElementById("enemyNameInput") ? document.getElementById("enemyNameInput").value : "Enemy Clan",
    enemyLogo: document.getElementById("enemyLogo").src || "",
    rows: []
  };
  const map = document.getElementById("warMap");
  const warRows = map.querySelectorAll(".war-row");
  warRows.forEach(row => {
    const rowData = {
      spqrName: row.querySelector(".base input") ? row.querySelector(".base input").value : "",
      spqrImg: row.querySelector(".base img") ? row.querySelector(".base img").src : "",
      enemyName: row.querySelector(".base.right input") ? row.querySelector(".base.right input").value : "",
      enemyImg: row.querySelector(".base.right img") ? row.querySelector(".base.right img").src : "",
      target: row.querySelector(".middle select").value
    };
    data.rows.push(rowData);
  });
  localStorage.setItem("warData", JSON.stringify(data));
}

function loadWarFromStorage(){
  const data = JSON.parse(localStorage.getItem("warData"));
  if(!data) return;
  warSize = data.warSize;
  document.getElementById("warSize").value = warSize;
  generateWarMap();
  document.getElementById("enemyNameInput").value = data.enemyName;
  updateEnemyName();
  if(data.enemyLogo) document.getElementById("enemyLogo").src = data.enemyLogo;
  const rows = document.getElementById("warMap").querySelectorAll(".war-row");
  data.rows.forEach((r,i) => {
    if(rows[i]){
      if(rows[i].querySelector(".base input")) rows[i].querySelector(".base input").value = r.spqrName;
      if(rows[i].querySelector(".base img") && r.spqrImg) { rows[i].querySelector(".base img").src = r.spqrImg; rows[i].querySelector(".base img").style.display="block";}
      if(rows[i].querySelector(".base.right input")) rows[i].querySelector(".base.right input").value = r.enemyName;
      if(rows[i].querySelector(".base.right img") && r.enemyImg) { rows[i].querySelector(".base.right img").src = r.enemyImg; rows[i].querySelector(".base.right img").style.display="block";}
      if(rows[i].querySelector(".middle select")) rows[i].querySelector(".middle select").value = r.target;
    }
  });
  if(isMember && !isAdmin){
    rows.forEach(row => {
      row.querySelectorAll(".base input, .base.right input, .base input[type=file], .base.right input[type=file]").forEach(inp => {
        inp.disabled = true;
      });
    });
  }
}

function deleteWar(){
  localStorage.removeItem("warData");
  localStorage.removeItem("enemyLogoData");
  localStorage.removeItem("warSize");
  document.getElementById("warMap").innerHTML = "";
  document.getElementById("enemyNameInput").value = "";
  updateEnemyName();
}
</script>

</body>
</html>